# bomb_cat
2024-2025学年第2学期

| 成员(未注册github的用大写字母代替) | 个人任务（每人均为20%） |
| --- | --- |
| miracle-555 | 1.负责整体上的小组任务分工与协商<br><br>2.提供游戏本身整体框架上的灵感与设计<br><br>3.负责了整个“炸弹猫”游戏核心逻辑——战斗过程与相关判定——的代码撰写<br><br>4.负责游戏内部UI界面设计的思路以及游戏画面风格的敲定<br><br>5.负责了对游戏中游戏主界面基础部分（包括顶部状态栏和底部菜单栏）代码的撰写<br><br>6.负责对主界面中“卡片”部分的逻辑设计与相关函数的编写，特别是抽卡前的界面布局与抽卡后的画面显示<br><br>7.负责对主界面中“图鉴”部分的代码撰写，特别是与鼠标悬停与滚动交互相关的部分<br><br>8.负责将过程中间其他成员编写的较为复杂且不是很有序的部分代码分块打包整理<br><br>9.负责针对满足不同功能的代码在不同文件中布局的设计（包括main.py、my_game.py、monster.py、prop.py、you.py等等），包括每个文件中不同类的设定<br><br>10.负责游戏撰写完后的简单测试<br><br>11.负责编写了几个简单的monster与prop中的对象<br><br>12.负责一些细节处代码的维护与优化<br><br>13.负责文档最后一部分——总结与反思——的撰写 |
| hkensk | 1..在monster.py部分，编写了清道夫，阎魔，死灵骷髅，死灵法师，扒手等怪物的代码，设置了其特点和特殊卡牌，为其技能的实现重编了部分运行代码。<br><br>2\. 在prop.py部分，编写了下注, 净化, 先机, 喷发, 祈雨, 淘金, 冰爆术, 烈火,召唤, 偷窃等卡牌的效果，添加了对应的卡牌实例，以及对应的卡牌执行代码。<br><br>3.为战斗界面的玩家和怪物名字添加了边框，并且设置了鼠标位置检查，以使鼠标移至玩家和怪物的边框上时改变颜色实现反馈。<br><br>4.编写了选择目标函数，为战斗环节添加了新的选择分支以使选择目标的功能得以实现，而不至于影响正常循环，实现了直接在界面选择目标的功能。<br><br>5.编写了buff相关的变量和函数，以使玩家和怪物的buff正常执行，并且可以通过卡牌实现buff的增减，以实现更多玩法。<br><br>6.重新编写了mygame中的coin相关代码，以使可以通过卡牌实现战斗内金币的增加，以此来实现淘金和偷窃等卡牌的功能。<br><br>7.在怪物回合时增加了画面更新函数，以使战斗更加流畅，减少战斗卡顿。<br><br>8.增加了不会高亮显示的绘制界面函数，防止出现怪物回合时一直高亮显示卡牌的问题。<br><br>9.重新编写了炽热的代码，以使炽热的卡牌效果得以正常执行。<br><br>10.编写了开始界面的相关代码，实现了开始界面的显示和运作.<br><br>11.制作了开始界面和战斗界面的背景图，寻找了游戏需要的特殊字体<br><br>12.调整了游戏结束时显示文字的位置，使得文字居于画面中心，使界面更加美观 |
| 成员A | 1.添加背景音乐模块，支持游戏内音乐播放<br><br>2\. 分辨率与适配优化。发现已有程序存在显示不全的情况，调整游戏分辨率至目标尺寸（如 1280×720 或 1920×1080），并修改其他相应数据，确保UI元素适配。<br><br>3.调整关卡设置，使关卡难度更符合递增的逻辑<br><br>4.检查并调整怪物名称，使能正常显示。<br><br>5.调整昵称输入部分代码，使之兼容大写字母<br><br>6.进行文档一二部分撰写，整合回顾大家的设计思路<br><br>7.进行代码注释和解析，进行文档三四部分的撰写<br><br>8.最终检查运行效果，进行第五部分撰写<br><br>9.进行ppt制作 |
| 成员B | 1.编写剧情展示函数 plot()，完成游戏前情故事界面设计，文本内容包含 6 行故事线，添加 “继续” 按钮，点击后触发界面跳转逻辑。<br><br>2.编写昵称输入函数input_nickname（），实现支持英文和数字的昵称输入功能，长度限制 12 字符，若未输入则默认昵称 为“Player”。<br><br>3.编写通关界面函数ending_screen（）函数，设计通关胜利面板，包含 “恭喜通关！” 标题和玩家信息展示，添加 “返回菜单” 和 “退出游戏” 两个按钮，水平排列于面板底部，点击后分别触发对应功能。<br><br>4.制作炸弹猫头像图片avatar.jpg、制作金币图片coin.jpg以使其符合游戏主题。<br><br>5.完善图鉴部分使怪物和卡牌功能清晰呈现。<br><br>6.在GameInterface类的主循环中添加关卡解锁逻辑，当完成当前关卡（current_round < 4）时自动提升轮次，全部完成后调用ending_screen()显示胜利界面。<br><br>7.新增变量self.max_rounds 、self.current_round、self.has_won_game用于控制通关。<br><br>8.编写怪物狐狸部分的功能代码。<br><br>9.开发薄荷、交换、放手一搏三张卡牌<br><br>10.补充“Jocker” 卡牌效果说明，明确 50% 概率触发愤怒值减半或手牌数字翻倍效果。 |
| 成员C | 1.编写添加游戏消息日志的函数add_massage，将原本的所有控制台输出（print语句）改为渲染到Pygame屏幕上。<br><br>2.改进my_game文件的代码结构：原代码中使用了大量的全局变量，可能导致状态管理混乱。因此我将游戏状态封装到面向对象的类中（GameState），提高代码的可维护性和可扩展性。<br><br>3.编写了加载关卡的函数load_round，实现多轮次战斗。<br><br>4.编写了检测鼠标点击选择卡牌的函数handle_card_selection，获取鼠标位置后遍历每张卡牌并计算卡牌位置以及进行碰撞检测，保证了玩家可以通过鼠标点击卡牌来出牌。<br><br>5.编写了绘制战斗界面的函数draw_interface，包括战斗界面背景、猫猫愤怒值绘制（愤怒值颜色警示：>80变红）、存活单位绘制、可滚动且拖动的消息日志与消息面板绘制、动态高亮的玩家手牌绘制。<br><br>6.编写了检测愤怒值状态的函数check_anger，保证怪物导致愤怒值超限时淘汰该怪物并调整愤怒值为199-当前值。<br><br>7.编写了显示游戏结束界面的函数show_game_result，设定玩家用鼠标点击该界面任意位置后都返回游戏初始主界面。<br><br>8.优化游戏主循环函数game_loop，增添每结束一轮后coin增加（100\*当前战斗的Round数）的设定；让全局游戏状态（gs）贯穿整个循环，确保了数据一致性；明确分离玩家和怪物的回合，确保玩家操作后才会触发怪物回合。<br><br>9.优化摸牌函数shuffle_cards，采用深拷贝替代原本的浅拷贝，避免修改原始卡牌列表，且允许牌库中有重复卡牌。<br><br>10.优化摸牌函数draw_card，额外考虑了怪物是否存活的情况，避免让已经淘汰的对象再次摸牌。<br><br>11.调整my_game的分辨率，改为与main.py相同的动态计算方式，并调整其他界面元素的坐标。<br><br>12.编写战斗菜单界面函数draw_battle_interface，绘制动态高亮的关卡按钮。<br><br>&nbsp;13.编写更新关卡按钮的函数update_round_button，确保玩家在当前轮次战斗胜利后返回游戏初始主界面时关卡按钮显示为下一关。<br><br>&nbsp;14.编写主循环函数run的战斗部分（if current_tab == '战斗'），包括更新coin以及实现输了继续当前关卡、赢了进入下一轮关卡的逻辑。<br><br>&nbsp;15.设计并编写了胆小鬼、小丑和魔女的出牌策略，同时添加异常处理。 |
|     |     |     |
| 完成日期 | 2025年5 月 30 日 |     |     |

1. 选题

程序名称：《炸弹猫》

选题原因：《炸弹猫》是一款基于卡牌策略的原创游戏，灵感来源于微信小程序“拆弹猫”。通过Python实现，我们设计了独特的愤怒值机制和卡牌交互系统。游戏结合了策略性与随机性，玩家需通过卡牌组合控制猫的愤怒值，避免其爆炸。相较于传统游戏，本项目的创新点在于：

1.动态愤怒值系统：实时变化的愤怒值增加游戏紧张感。

2.原创卡牌效果：如“炽热”“祈雨”等卡牌提供多样策略选择。

3.模块化设计：代码结构清晰，便于扩展新关卡或卡牌类型。

1. 需求分析

《炸弹猫》是一款基于Python和Pygame开发的卡牌策略游戏，灵感来源于经典的卡牌游戏玩法。游戏设定在一个被诅咒的猫王国中，玩家需要通过合理使用卡牌来对抗邪恶的猫巫师释放的炸弹猫瘟疫。游戏的核心玩法围绕卡牌策略展开，玩家需要管理愤怒值、使用功能牌与数字牌，击败怪物并完成关卡挑战。

**1.目标用户**

Python初学者：代码结构清晰，注释详细，适合学习Pygame和游戏开发逻辑。

策略游戏爱好者：游戏提供了丰富的卡牌和怪物机制，适合喜欢策略和挑战的玩家。

休闲玩家：简单的操作和有趣的故事情节，适合休闲娱乐。

**2.功能需求**

游戏初始化：

加载游戏窗口、音乐、图片资源。

设置游戏分辨率、标题和颜色主题。

主菜单界面：

提供开始游戏、退出游戏选项。

游戏主界面：

战斗模块：玩家与怪物轮流出牌，管理愤怒值。

卡牌模块：抽卡功能，支持单抽和十连抽。

图鉴模块：展示卡牌和怪物的详细信息。

战斗逻辑：

玩家和怪物轮流出牌，数字牌增加愤怒值，功能牌触发特殊效果。

愤怒值超过100时，当前出牌者失败（玩家失败或怪物被淘汰）。

击败所有怪物后解锁下一关。

卡牌系统：

数字牌：直接增加愤怒值。

功能牌：提供特殊效果（如降低愤怒值、净化debuff、指定抽牌等）。

抽卡机制：玩家可以通过消耗金币抽取新卡牌。

关卡设计：

多关卡挑战，每关怪物配置不同。

关卡胜利后奖励金币，失败后返回主菜单。

音效与UI：

背景音乐增强游戏沉浸感。

清晰的文本提示和交互反馈

**3.创新点**

愤怒值机制：独特的愤怒值系统，玩家和怪物共同影响同一数值，增加策略深度。

功能牌设计：多样化的功能牌效果，如“祈雨”（增减愤怒值）、“喷发”（随机破坏怪物手牌）。

故事情节：融入背景故事，提升游戏代入感。

**4.技术难点与解决方案**

卡牌效果实现：通过全局变量和函数调用实现复杂效果（如指定抽牌、净化debuff）。

**解决方案**：使用模块化设计，将卡牌效果封装为独立的函数或类方法。

战斗逻辑同步：确保玩家和怪物的回合交替进行，愤怒值实时更新。

**解决方案**：使用状态变量（如is_player_turn）控制回合切换。

界面交互：支持卡牌选择、日志滚动、面板拖动等操作。

**解决方案**：利用Pygame的事件检测和矩形碰撞检测实现交互

1. 程序设计

（说明程序的主要模块；说明需要定义的类及其成员；说明需要定义的功能函数及其算法。鼓励增加图表进行说明。）

**1.主要模块**

| 模块  | 功能  |
| --- | --- |
| main.py | 主循环、界面渲染（菜单/战斗）、事件处理 |
| my_game.py | 游戏逻辑（回合制流程、胜负判定、愤怒值计算） |
| prop.py | 卡牌效果实现（如“炽热”修改手牌数字、“净化”清除Debuff） |
| monster.py | 怪物行为逻辑（自动出牌策略） |

**2.关键类设计**

- 1. Game_state类

成员变量：

Score_anger:当前猫的愤怒值（范围0-100），≥100时触发爆炸

players_alive: 存活单位字典，键为玩家ID（0=玩家），值为名称

cards_hand: 玩家当前手牌（数字牌为int，功能牌为str）

cards_monsters: 各怪物的牌库（索引对应players_alive中的ID-1）

current_round: 当前关卡编号（1-8）

message_log: 游戏消息记录，格式为(文本, 颜色)

方法：

\__init_\_(self)：初始化游戏状态，默认愤怒值30-80随机

draw_card(self, player)：为玩家/怪物抽牌，支持指定抽牌（如“先机”牌效果）

load_round(self, round_obj)：加载关卡配置，初始化怪物和牌库

add_message(self, text)：添加游戏消息到日志，自动限制最大行数

handle_victory(self): 处理胜利逻辑：解锁下一关或通关

- 1. prop类（卡牌效果基类）

成员变量：

Name: 卡牌名称（如“寒冰”“炽热”）

Number: 卡牌编号（唯一标识）战斗流程

Function: 卡牌效果描述文本

方法：

\__init_\_(name, num, func)：初始化卡牌属性

Card_func(player，…) : 执行卡牌效果：  
• player=0为玩家出牌  
• choose指定目标怪物

典型卡牌效果实现：

\# 示例：炽热牌（所有数字牌+2）

def card_func(self, player, choose=0):

if player != 0: # 怪物使用时

for i, card in enumerate(gs.cards_monsters_hand\[choose-1\]):

if isinstance(card, int):

gs.cards_monsters_hand\[choose-1\]\[i\] += 2

else: # 玩家使用时

gs.cards_hand = \[c+2 if isinstance(c, int) else c for c in gs.cards_hand\]

- 1. main_menu类

成员变量：

elements：界面元素字典（如标题、按钮文本及位置）

button_hitboxes：按钮点击区域（键为按钮类型，值为Pygame.Rect对象）

music_on：背景音乐开关状态

方法：

Create_text(text,font_type)：生成文本表面和矩形区域（居中定位）

draw_element(element)：渲染界面元素（自动处理悬停高亮）

run(self)：主循环：处理事件（点击/音乐切换）并返回游戏开始标志

- 1. monster类

成员变量：

Name：怪物名称（如“清道夫”“死灵髅楼”）

Cards：怪物专属卡牌池

Strategy：怪物行为策略描述

1. 开发环境和关键代码

**1.开发环境**

- Python 3.11.4 + Pygame 2.5
- 第三方库：random（随机抽牌）、sys（退出处理）

**2.关键代码**

1.游戏初始化与主菜单

def init_settings():

pygame.init()

pygame.mixer.init()

WIDTH, HEIGHT = 1792 // 2, 1024 // 2 # 设置窗口分辨率

screen = pygame.display.set_mode((WIDTH, HEIGHT))

pygame.display.set_caption("炸弹猫")

return screen, WIDTH, HEIGHT

class Main_Menu:

def \__init_\_(self, screen, WIDTH, HEIGHT):

self.screen = screen

self.elements = {

'title': self.create_text("炸弹猫", 'title', (WIDTH // 2, HEIGHT // 4)),

'start_btn': self.create_text("开始游戏", 'button', (WIDTH // 2, HEIGHT // 2)),

'quit_btn': self.create_text("退出游戏", 'button', (WIDTH // 2, HEIGHT // 2 + HEIGHT//6))

}

self.button_hitboxes = { # 按钮点击区域

'start': self.elements\['start_btn'\]\[1\].inflate(40, 20),

'quit': self.elements\['quit_btn'\]\[1\].inflate(40, 20)

}

**功能说明：**

init_settings() 初始化 Pygame 窗口、音频和分辨率。

Main_Menu 类负责绘制主菜单界面，包括标题、开始按钮和退出按钮，并处理鼠标点击事件。

2\. 战斗逻辑与愤怒值管理

class Game_State:

def \__init_\_(self):

self.score_anger = random.randint(30, 80) # 初始愤怒值

self.players_alive = {0: "玩家"} # 存活单位（玩家 + 怪物）

self.cards_hand = \[\] # 玩家手牌

self.flag = 0 # 0: 进行中, 1: 胜利, -1: 失败

def check_anger(self, current_player):

if self.score_anger >= 100:

if current_player == 0: # 玩家导致愤怒值爆炸，游戏失败

self.flag = -1

else: # 怪物导致愤怒值爆炸，怪物被淘汰

del self.players_alive\[current_player\]

self.score_anger = max(199 - self.score_anger, 0) # 愤怒值重置

if len(self.players_alive) == 1: # 仅剩玩家，胜利

self.flag = 1

**功能说明：**

Game_State 类管理游戏状态，包括愤怒值、存活单位、手牌等。

check_anger() 检测愤怒值是否超过 100，并处理胜利或失败逻辑。

3\. 卡牌系统与功能牌效果

class Prop:

def \__init_\_(self, name, serial_number, function):

self.name = name

self.number = serial_number

self.function = function

def card_func(self, player, score_anger, cards_hand, choose=0):

if self.name == "寒冰":

score_anger -= 10 # 愤怒值 -10

elif self.name == "炽热":

if player == 0: # 玩家使用

for i, card in enumerate(cards_hand):

if isinstance(card, int):

cards_hand\[i\] += 2 # 所有数字牌 +2

else: # 怪物使用

for i, card in enumerate(cards_monsters_hand\[choose - 1\]):

if isinstance(card, int):

cards_monsters_hand\[choose - 1\]\[i\] += 2

return score_anger, cards_hand

**功能说明：**

Prop 类定义卡牌属性（名称、编号、功能描述）。

card_func() 实现卡牌效果，如“寒冰”降低愤怒值，“炽热”增强数字牌。

4\. 怪物回合逻辑

def play_card(self, pid, monster_card):

monster = self.players_alive\[pid\]

hand = self.cards_monsters_hand\[pid - 1\]

if monster.name == "清道夫":

hand\[random.randint(0, 3)\] = 0 # 随机一张牌变 0

if isinstance(monster_card, int): # 数字牌

self.score_anger += monster_card

else: # 功能牌

card_obj = prop.dict_props\[monster_card\]

card_obj.card_func(pid, self.score_anger, hand)

**功能说明：**

怪物根据自身策略选择卡牌（如“清道夫”会随机将一张牌变为 0）。

数字牌直接增加愤怒值，功能牌触发对应效果。

5.游戏主循环

def game_loop(round_num=1):

clock = pygame.time.Clock()

is_player_turn = True

while True:

for event in pygame.event.get():

if event.type == pygame.QUIT:

pygame.quit()

sys.exit()

if is_player_turn: # 玩家回合

if event.type == pygame.MOUSEBUTTONDOWN:

selected = handle_card_selection()

if selected:

play_card(0, selected)

is_player_turn = False # 切换到怪物回合

else: # 怪物回合

for pid in list(gs.players_alive.keys()):

if pid != 0: # 跳过玩家

monster_card = choose_monster_card(pid)

play_card(pid, monster_card)

is_player_turn = True # 切换回玩家回合

draw_interface()

clock.tick(60) # 60 FPS

**功能说明：**

主循环控制玩家和怪物的回合交替。

玩家通过鼠标选择卡牌，怪物自动出牌。

每帧刷新界面，保持流畅体验。

5.运行方法和效果

**1.操作指南**

启动游戏：运行main.py，进入主菜单。

游戏流程：

输入昵称 → 查看剧情 → 进入战斗界面。

点击卡牌出牌，功能牌需选择目标（如“炽热”指定怪物）。

击败所有怪物后通关，获得金币奖励。

**2.效果截图**

初始界面：

(待补)

**说明：**分类展示卡牌和怪物的名称、功能及策略说明。

支持滚动查看所有条目。

6.总结反思与未来展望

**1．小组合作与开发历程**

本次项目自4月启动至5月末完成，历时近两个月，采用接力式代码开发模式，由小组成员分阶段负责不同模块的设计与实现。开发初期，我们围绕游戏核心玩法（卡牌策略+愤怒值管理）展开过多次讨论，确定了“关卡递进(不同的怪物组合)+功能牌组合”的基本框架，并将主要任务拆解为主菜单系统、战斗逻辑、卡牌系统、怪物系统等四个核心模块。

在接力开发过程中，我们通过不定期交接代码来同步进度，但仍不可避免遇到以下挑战：

**设计思路分歧：**

主菜单界面设计中，部分成员倾向极简风格乃至文字游戏，另一部分主张加入动画特效，导致初期发生反复修改。

战斗细节中，有成员提出要增设血量条与生命值系统，但考虑到实际时间和精力成本有限，最终不了了之。

**代码可读性与交接成本：**

早期未统一代码规范，不同成员的变量命名、注释风格差异显著，导致后续开发者需花费额外时间清点理解逻辑。

**时间协调困难：**

小组内部每个人各有自己的事情，导致很难协调出合适的时间在一起讨论问题和协商相关事项。

**2．问题解决与经验积累**

针对上述挑战，我们通过以下措施逐步优化开发流程：

1.统一规范与协作机制：

统一代码风格：强制要求变量命名采用lower_case_underscore格式；同时强制要求代码封装和足够的注释量。

2.采取利用零碎时间线上交流的策略；同时由组长协调了解每个人的时间安排，在合理的时间为每个人安排适合对方的任务，同时调整每个人的任务量，尽可能保持均摊。

**3．未来展望**

基于现有成果，我们计划在以下方向持续优化 \[以下内容均因为时间有限，暂时并没有完善\]：

**功能扩展：**

新增卡牌与怪物：可能设计“治疗牌”（降低愤怒值）与“陷阱牌”（冻结怪物）等功能牌，同时引入可以无视部分卡牌效果或者免疫单次伤害的特殊怪物。

多人联机模式：通过网络模块实现2-4人合作(PVE)或对抗(PVP)。

增添游戏模块：如添加“个人成就”与“任务”等游戏中常见的模块。

**体验升级：**

界面布局：采用响应式设计适配不同屏幕尺寸，以此来优化界面的布局。

美术：尝试用AI或者其他工具为其中的怪物和道具牌提供配图，更有沉浸式体验。

音乐与音效：增加按钮点击与战斗部分的音效；同时在不同的功能下提供不同的背景音乐。

文案设计：为每个怪物或者卡牌提供背景或者简单介绍，提高游戏丰度。

**4.总结**

从初期的设计分歧到最终可运行的完整版本，团队成员通过良好的协作逐步突破技术与沟通壁垒。本次项目不仅实现了“用Python复现卡牌策略游戏”的目标，更让我们深刻理解：在多人开发中，统一规范的重要性高于个人创意，而清晰的文档与测试机制是项目可持续演进的基石，保持团队之间的密切交流与分工协作更是其中必不可缺的一环。事实上，因为时间有限制的原因，其实代码还有很多地方可以值得去完善，本小组已打算在暑假时期利用空余时间进一步调整代码与完善并将其上传到开源网站上，希望能让更多的人看到我们的努力的同时并能够从我们的一点点贡献中有自己独特的收获。
